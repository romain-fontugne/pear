{% extends 'base.html' %}

{% block head %}
<title>Traffic data</title>
{% endblock %}

{% block body %}
<h1>Traffic data: {{ selected_router }}</h1>

<div class="dropdown">
  <button type="button" class="btn btn-primary dropdown-toggle" data-toggle="dropdown">
    Select a router
  </button>
  <div class="dropdown-menu">
      {% for router in router_names %}
        <a class="dropdown-item" href="/traffic?router={{router}}">{{router}}</a>
      {% endfor %}
  </div>
</div>

<div class='row'>
    <div class='col'>
        <div id="trafficASNPlot">
        </div>
    </div>
    <div class='col'>
        <div id="trafficCountryPlot">
        </div>
    </div>
</div>
<table id="trafficTable" class="table table-striped table-sm table-hover" width="100%">
    <thead>
    <tr>
        <th>Router</th>
        <th>Origin ASN</th>
        <th>Prefix</th>
        <th>Traffic Volume</th>
        <th>Country</th>
        <th>AS path</th>
        <th>Description</th>
    </tr>
    </thead>
    <tbody>
    {% for router_name, traffic in flows.items() %}
      {% for prefix, values in traffic.items() %}
        <tr>
            <td>{{ router_name }}</td>
            <td>AS{{ values.info.originasn }}</td>
            <td>{{ prefix }}</td>
            <td>{{ values.vol }}</td>
            <td>{{ values.info.country }}</td>
            <td>
                {% for asn in values.info.aspath %}{{ asn }}&nbsp;&nbsp;{% endfor %}
            </td>
            <td> {{ values.info.descr }} </td>
        </tr>
      {% endfor %}
    {% endfor %}
    </tbody>
</table>

{% endblock %}

{% block footer %}
<script type="text/javascript">
    $(document).ready(function () {
        var table = $('#trafficTable').DataTable({
            "paging": false,
            "searchDelay": 750,
            "drawCallback": function () {
            },
            "fnInitComplete": function () { },
            "scrollY": 850,
        });
    $('.dataTables_length').addClass('bs-select');

    console.log('start drawing')
    drawTraffic('trafficTable', 'trafficASNPlot', 'Origin ASN');
    console.log('second drawing')
    drawTraffic('trafficTable', 'trafficCountryPlot', 'Country');

    });
</script>
{% endblock %}
